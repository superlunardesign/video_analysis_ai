<!DOCTYPE html>
<html>
<head>
  <title>Video Analysis Results</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.6;
      color: #1a1a1a;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
      padding: 20px 0;
    }
    
    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      font-weight: 700;
    }
    
    .header p {
      font-size: 1.1rem;
      opacity: 0.95;
    }
    
    /* Performance Scores Section */
    .scores-section {
      background: white;
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    
    .scores-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 20px;
      margin-top: 25px;
    }
    
    .score-card {
      text-align: center;
      padding: 20px;
      border-radius: 12px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      position: relative;
      overflow: hidden;
    }
    
    .score-card::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: shimmer 3s infinite;
    }
    
    @keyframes shimmer {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .score-value {
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .score-label {
      font-size: 0.9rem;
      opacity: 0.95;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    /* Content Cards */
    .content-card {
      background: white;
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 25px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.08);
    }
    
    .content-card h2 {
      font-size: 1.5rem;
      margin-bottom: 20px;
      color: #2d3748;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .content-card h3 {
      font-size: 1.2rem;
      margin: 20px 0 15px 0;
      color: #4a5568;
    }
    
    .content-text {
      color: #4a5568;
      line-height: 1.8;
      font-size: 1.05rem;
    }
    
    /* Hook Analysis Cards */
    .hooks-analysis {
      display: grid;
      gap: 20px;
      margin-top: 20px;
    }
    
    .hook-card {
      background: linear-gradient(135deg, #f6f9fc 0%, #e9ecef 100%);
      border-left: 4px solid #667eea;
      padding: 20px;
      border-radius: 8px;
    }
    
    .hook-card h4 {
      color: #2d3748;
      margin-bottom: 10px;
      font-size: 1.1rem;
    }
    
    .hook-type {
      display: inline-block;
      background: #667eea;
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      margin-bottom: 10px;
    }
    
    /* Alternative Hooks */
    .alt-hooks-grid {
      display: grid;
      gap: 15px;
      margin-top: 20px;
    }
    
    .alt-hook-item {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      padding: 18px;
      border-radius: 10px;
      border-left: 4px solid #f59e0b;
      font-style: italic;
      font-size: 1.05rem;
      color: #1a1a1a;
      position: relative;
      cursor: pointer;
      transition: transform 0.2s;
    }
    
    .alt-hook-item:hover {
      transform: translateX(5px);
    }
    
    .alt-hook-item::before {
      content: '"';
      font-size: 2rem;
      position: absolute;
      top: 10px;
      left: 15px;
      opacity: 0.3;
    }
    
    /* Formula Sections */
    .formula-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .formula-tab {
      padding: 10px 20px;
      background: #f7fafc;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
    }
    
    .formula-tab:hover {
      background: #edf2f7;
    }
    
    .formula-tab.active {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }
    
    .formula-content {
      display: none;
      background: #f7fafc;
      padding: 25px;
      border-radius: 10px;
      border: 1px solid #e2e8f0;
    }
    
    .formula-content.active {
      display: block;
    }
    
    .formula-content pre {
      white-space: pre-wrap;
      font-family: 'Courier New', monospace;
      background: white;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      margin-top: 15px;
    }
    
    /* Info Boxes */
    .info-box {
      background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
      border: 1px solid #0ea5e9;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .warning-box {
      background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
      border: 1px solid #f59e0b;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .success-box {
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      border: 1px solid #10b981;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
    }
    
    /* Gallery Grid */
    .frame-gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .frame-item {
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: transform 0.3s;
    }
    
    .frame-item:hover {
      transform: scale(1.05);
    }
    
    .frame-item img {
      width: 100%;
      height: auto;
      display: block;
    }
    
    /* Transcript Section */
    .transcript-box {
      background: #f7fafc;
      padding: 25px;
      border-radius: 10px;
      border: 1px solid #e2e8f0;
      margin-top: 20px;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .transcript-box pre {
      white-space: pre-wrap;
      font-family: inherit;
      line-height: 1.8;
    }
    
    /* Copy Button */
    .copy-btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      margin-top: 15px;
      transition: all 0.3s;
    }
    
    .copy-btn:hover {
      background: #5a67d8;
      transform: translateY(-2px);
    }
    
    .copy-btn.copied {
      background: #10b981;
    }
    
    /* Back Link */
    .back-link {
      display: inline-block;
      background: white;
      color: #667eea;
      text-decoration: none;
      padding: 15px 30px;
      border-radius: 30px;
      margin: 30px 0;
      font-weight: 600;
      transition: all 0.3s;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .back-link:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
    
    /* Details/Summary Styling */
    details {
      margin-top: 20px;
    }
    
    summary {
      cursor: pointer;
      font-weight: 600;
      color: #667eea;
      padding: 10px;
      background: #f7fafc;
      border-radius: 8px;
      transition: background 0.3s;
    }
    
    summary:hover {
      background: #edf2f7;
    }
    
    /* Meta Tags */
    .meta-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }
    
    .meta-tag {
      background: rgba(255,255,255,0.2);
      color: white;
      padding: 6px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.3);
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      .header h1 {
        font-size: 2rem;
      }
      
      .scores-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .content-card {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>🎯 Video Performance Analysis</h1>
      <p>Understanding what makes content work (or not)</p>
      <div class="meta-tags">
        <span class="meta-tag">{{ platform.title() }}</span>
        <span class="meta-tag">{{ target_duration }}s video</span>
        <span class="meta-tag">Goal: {{ goal.replace('_', ' ').title() }}</span>
        <span class="meta-tag">{{ frames_count }} frames analyzed</span>
      </div>
    </div>

    <!-- Performance Scores -->
    <div class="scores-section">
      <h2>📊 Performance Breakdown</h2>
      <p style="color: #4a5568; margin-top: 10px;">Here's how your video scored across key viral factors:</p>
      <div class="scores-grid">
        <div class="score-card">
          <div class="score-value">{{ scores.hook_strength }}/10</div>
          <div class="score-label">Hook Power</div>
        </div>
        <div class="score-card">
          <div class="score-value">{{ scores.promise_clarity }}/10</div>
          <div class="score-label">Clear Promise</div>
        </div>
        <div class="score-card">
          <div class="score-value">{{ scores.retention_design }}/10</div>
          <div class="score-label">Retention Design</div>
        </div>
        <div class="score-card">
          <div class="score-value">{{ scores.engagement_potential }}/10</div>
          <div class="score-label">Engagement Power</div>
        </div>
        <div class="score-card">
          <div class="score-value">{{ scores.goal_alignment }}/10</div>
          <div class="score-label">Goal Match</div>
        </div>
      </div>
    </div>

    <!-- What's Happening in the Video -->
    <div class="content-card">
      <h2>🎬 What's Happening in Your Video</h2>
      <div class="content-text">
        {% if visual_content_analysis and visual_content_analysis.description %}
          <p>{{ visual_content_analysis.description }}</p>
        {% endif %}
        
        {% if transcript_quality and not transcript_quality.is_reliable %}
          <div class="info-box" style="margin-top: 15px;">
            <strong>Audio Note:</strong> {{ audio_description or "This appears to be a visual-focused video with ambient audio rather than speech." }}
          </div>
        {% endif %}
        
        <h3>The Flow:</h3>
        <p>{{ timing_breakdown or "The video progresses through distinct phases designed to maintain viewer attention." }}</p>
      </div>
    </div>

    <!-- Why It Did/Didn't Go Viral -->
    <div class="content-card">
      <h2>🚀 Viral Performance Analysis</h2>
      <div class="content-text">
        {% if creator_note %}
          <div class="warning-box">
            <strong>Your Context:</strong> {{ creator_note }}
          </div>
        {% endif %}
        
        <h3>Why This Video {{ "Worked" if overall_quality == "strong" else "Didn't Perform As Expected" }}:</h3>
        <p>{{ analysis }}</p>
        
        {% if performance_prediction %}
          <h3>Performance Prediction:</h3>
          <p>{{ performance_prediction }}</p>
        {% endif %}
        
        {% if knowledge_insights %}
          <h3>Based on Viral Patterns:</h3>
          <p>{{ knowledge_insights }}</p>
        {% endif %}
      </div>
    </div>

    <!-- Hook Analysis -->
    <div class="content-card">
      <h2>🎣 Hook Breakdown: The First 3 Seconds</h2>
      <div class="content-text">
        <p>The opening moments are everything. Here's what's happening in yours:</p>
        
        <div class="hooks-analysis">
          <!-- Visual Hook -->
          <div class="hook-card">
            <span class="hook-type">VISUAL HOOK</span>
            <h4>What viewers see first</h4>
            <p>{{ visual_content_analysis.description if visual_content_analysis else "The visual opening creates the first impression through imagery and movement." }}</p>
          </div>
          
          <!-- Text Hook -->
          {% if text_sync_analysis and (text_sync_analysis.has_graphics or text_sync_analysis.has_captions) %}
          <div class="hook-card">
            <span class="hook-type">TEXT HOOK</span>
            <h4>On-screen text elements</h4>
            <p>
              {% if text_sync_analysis.has_graphics %}
                Graphics/overlays detected that are separate from captions - these serve as visual hooks to grab attention.
              {% elif text_sync_analysis.has_captions %}
                Text appears to be synchronized captions rather than standalone hook text.
              {% endif %}
            </p>
          </div>
          {% endif %}
          
          <!-- Verbal Hook -->
          {% if transcript and transcript|length > 10 %}
          <div class="hook-card">
            <span class="hook-type">VERBAL HOOK</span>
            <h4>What's being said</h4>
            <p>Opening words: "{{ transcript[:100] }}..."</p>
          </div>
          {% endif %}
        </div>
        
        <h3>Why This Hook {{ "Works" if scores.hook_strength >= 7 else "Could Be Stronger" }}:</h3>
        <p>{{ strengths if scores.hook_strength >= 7 else improvement_areas }}</p>
      </div>
    </div>

    <!-- Engagement Psychology -->
    <div class="content-card">
      <h2>💭 Why People Will (or Won't) Engage</h2>
      <div class="content-text">
        <h3>Share Triggers:</h3>
        <p>{{ engagement_psychology or "Content that gets shared typically makes the sharer look good, teaches something valuable, or entertains their audience." }}</p>
        
        <h3>Comment Drivers:</h3>
        <p>{{ "This content invites discussion through controversy, questions, or relatable moments." if scores.engagement_potential >= 7 else "To drive more comments, consider adding controversial takes, direct questions, or polarizing statements." }}</p>
        
        <h3>Save Motivations:</h3>
        <p>{{ "The valuable information or transformation shown makes this worth saving for later." if scores.engagement_potential >= 6 else "Adding more actionable value or reference-worthy content would increase saves." }}</p>
        
        <h3>Rewatch Value:</h3>
        <p>{{ viral_mechanisms if viral_mechanisms else "Videos get rewatched when they're satisfying, contain hidden details, or deliver high entertainment value in a short time." }}</p>
      </div>
    </div>

    <!-- Viral Potential -->
    <div class="content-card">
      <h2>📈 Viral Potential Score</h2>
      <div class="content-text">
        {% set viral_score = (scores.hook_strength + scores.promise_clarity + scores.retention_design + scores.engagement_potential + scores.goal_alignment) / 5 %}
        
        <div class="{{ 'success-box' if viral_score >= 7 else 'warning-box' if viral_score >= 5 else 'info-box' }}">
          <h3>Overall Viral Potential: {{ "High" if viral_score >= 7 else "Moderate" if viral_score >= 5 else "Needs Work" }}</h3>
          <p>
            {% if viral_score >= 7 %}
              This content has strong viral indicators and aligns well with proven patterns. With the right timing and audience, it should perform well.
            {% elif viral_score >= 5 %}
              This content has potential but needs optimization in key areas. Focus on the improvements below to increase viral likelihood.
            {% else %}
              This content needs significant improvements to compete in the algorithm. The good news? Every suggestion below is actionable.
            {% endif %}
          </p>
        </div>
        
        <h3>Knowledge Base Alignment:</h3>
        <p>{{ knowledge_insights or "Comparing against proven viral patterns in our knowledge base." }}</p>
      </div>
    </div>

    <!-- Alternative Hooks -->
    <div class="content-card">
      <h2>🔄 Alternative Hooks to Test</h2>
      <p style="color: #4a5568; margin-bottom: 20px;">These aren't generic templates - they're specific to your content style:</p>
      
      <div class="alt-hooks-grid">
        {% for hook in hooks %}
          <div class="alt-hook-item">{{ hook }}</div>
        {% endfor %}
      </div>
      
      <button class="copy-btn" onclick="copyHooks()">Copy All Hooks</button>
    </div>

    <!-- Replication Formulas -->
    <div class="content-card">
      <h2>📋 Replication Formulas</h2>
      <p style="color: #4a5568; margin-bottom: 20px;">Different ways to recreate this video's success:</p>
      
      <div class="formula-tabs">
        <button class="formula-tab active" onclick="showFormula('basic')">Quick Structure</button>
        <button class="formula-tab" onclick="showFormula('timing')">With Timing</button>
        <button class="formula-tab" onclick="showFormula('template')">Fill-in Template</button>
        <button class="formula-tab" onclick="showFormula('psychology')">Psychology Map</button>
      </div>
      
      <div id="basic-formula" class="formula-content active">
        <h3>Quick Structure</h3>
        <pre>{{ basic_formula or formula or "1. Open with attention-grabbing visual\n2. State the promise clearly\n3. Build anticipation through the middle\n4. Deliver satisfying payoff\n5. End with engagement trigger" }}</pre>
      </div>
      
      <div id="timing-formula" class="formula-content">
        <h3>Timing Breakdown</h3>
        <pre>{{ timing_formula or "0-3s: Hook with strong visual/verbal opener\n3-7s: Clarify the promise\n7-15s: Build tension/anticipation\n15-25s: Deliver core value\n25-30s: Call-to-action or loop" }}</pre>
      </div>
      
      <div id="template-formula" class="formula-content">
        <h3>Fill-in Template</h3>
        <pre>{{ template_formula or "Hook: [Your attention grabber]\nPromise: [What they'll get]\nBuild: [How you develop interest]\nPayoff: [The valuable delivery]\nCTA: [What you want them to do]" }}</pre>
      </div>
      
      <div id="psychology-formula" class="formula-content">
        <h3>Psychology Framework</h3>
        <pre>{{ psychology_formula or "Create Curiosity Gap → Promise Resolution → Build Anticipation → Deliver Satisfaction → Trigger Action" }}</pre>
      </div>
    </div>

    <!-- Improvements -->
    <div class="content-card">
      <h2>💡 Specific Improvements</h2>
      <div class="content-text">
        <h3>Quick Wins:</h3>
        <p>{{ improvements or "Focus on strengthening your hook and clarifying your promise for immediate impact." }}</p>
        
        <h3>Bigger Changes:</h3>
        <p>{{ improvement_areas or "Consider restructuring your content flow to better match viral patterns from the knowledge base." }}</p>
      </div>
    </div>

    <!-- Transcript -->
    <div class="content-card">
      <h2>📝 Full Transcript</h2>
      <div class="transcript-box">
        <pre>{{ transcript or "(No verbal content - visual-only video)" }}</pre>
      </div>
    </div>

    <!-- Frames -->
    <div class="content-card">
      <h2>🎞️ Analyzed Frames</h2>
      <div class="frame-gallery">
        {% for img in frame_gallery %}
          <div class="frame-item">
            <img src="{{ img }}" alt="Frame from video" loading="lazy">
          </div>
        {% endfor %}
      </div>
      
      <details>
        <summary>View detailed frame-by-frame analysis</summary>
        <div class="transcript-box" style="margin-top: 15px;">
          <pre>{{ frame_summary }}</pre>
        </div>
      </details>
    </div>

    <center>
      <a href="/" class="back-link">← Analyze Another Video</a>
    </center>
  </div>

  <script>
    // Formula tab switching
    function showFormula(type) {
      // Hide all formulas
      document.querySelectorAll('.formula-content').forEach(el => {
        el.classList.remove('active');
      });
      
      // Remove active from all tabs
      document.querySelectorAll('.formula-tab').forEach(el => {
        el.classList.remove('active');
      });
      
      // Show selected formula
      document.getElementById(type + '-formula').classList.add('active');
      
      // Mark tab as active
      event.target.classList.add('active');
    }
    
    // Copy hooks function
    function copyHooks() {
      const hooks = [];
      document.querySelectorAll('.alt-hook-item').forEach(el => {
        hooks.push(el.textContent);
      });
      
      navigator.clipboard.writeText(hooks.join('\n\n')).then(() => {
        event.target.textContent = '✓ Copied!';
        event.target.classList.add('copied');
        
        setTimeout(() => {
          event.target.textContent = 'Copy All Hooks';
          event.target.classList.remove('copied');
        }, 2000);
      });
    }
  </script>
</body>
</html>