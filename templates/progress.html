<!DOCTYPE html>
<html>
<head>
    <title>Processing Video...</title>
    <style>
        .progress-container {
            width: 80%;
            margin: 100px auto;
            background: #f3f3f3;
            border-radius: 20px;
            overflow: hidden;
        }
        .progress-bar {
            height: 30px;
            width: 0%;
            background: linear-gradient(to right, #4cafef, #2196F3);
            text-align: center;
            line-height: 30px;
            color: white;
            font-weight: bold;
            transition: width 0.4s ease;
        }
    </style>
</head>
<body>
    <h2 style="text-align:center;">Analyzing your video...</h2>
    <div class="progress-container">
        <div class="progress-bar" id="progressBar">0%</div>
    </div>
    <div id="status" style="text-align:center;margin-top:20px;">Starting analysis...</div>

    <div id="results" style="display:none;margin-top:40px;"></div>

    <script>
        const formData = new FormData();
        const passedData = {{ form_data|tojson }};
        for (let key in passedData) {
            formData.append(key, passedData[key]);
        }

        let progress = 0;
        const bar = document.getElementById("progressBar");
        const statusText = document.getElementById("status");

        // Fake progress logic
        const interval = setInterval(() => {
            if (progress < 70) {
                progress += Math.random() * 3; // faster at start
            } else if (progress < 90) {
                progress += Math.random() * 0.5; // slower creep
            }
            if (progress > 90) progress = 90;
            bar.style.width = progress + "%";
            bar.textContent = Math.floor(progress) + "%";
        }, 1000);

        // Start actual processing
        fetch("/process", {
            method: "POST",
            body: formData
        })
        .then(res => res.text())
        .then(html => {
            clearInterval(interval);
            progress = 100;
            bar.style.width = "100%";
            bar.textContent = "100%";
            statusText.textContent = "Analysis complete!";
            document.getElementById("results").innerHTML = html;
            document.getElementById("results").style.display = "block";
        });
    </script>
</body>
</html>
